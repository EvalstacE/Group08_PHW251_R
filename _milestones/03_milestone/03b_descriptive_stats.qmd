
## Descriptive Statistics: Morbidity Datasets

```{r}

# Bring in final combined database
##-- CA + LA + Population
df <- read.csv(file = here("_data/cleaned_data/combined_df.csv"))

##-- final individual, cleaned databases:
ca_df <- read.csv(file = here("_data/cleaned_data/cleaned_ca_df.csv"))
la_cnty_df <- read.csv(file = here("_data/cleaned_data/cleaned_la_cnty_df.csv"))
pop_df <- read.csv(file = here("_data/cleaned_data/cleaned_pop_df.csv"))

```


to do: 

* Overall descriptive stats: 

  * infections by age group / county / region / race/ethnicity 
  * severe infections by age group / county / region / race/ethnicity
  * unrecovered infections by age group / county / region / race/ethnicity
  
  * infections/severe infections/unrecovered infections by MMWR week
  * infections/severe infections/unrecovered infections by MMWR week / county or region

* Create a rate metric and summarize to include only one row per strata of interest
* Aggregate the data into a new dataframe(s) to include only one row per strata of interest

  * crude rates (# / 100,000 population) per demographic: county, health officer region, sex, race / ethnicity



* maybe do age-adjusted / other adjusted rates later...
  * age-adjusted rates - compare AAR across county / region
  * Incidence rate / densities by age group and month?
  * Incidence rate / densities by race/ethnicity and month?
    


\newpage

## Calculating Crude Rates

see functions found in: "_functions/calc_total_rates_pop.R"

+ add explanation / documentation of functions here and what they do



\newpage

### Infection Rates by Health Officer Region


```{r, echo = FALSE}

by_HOR_week <- 
  counts_week_groups(
      df = df, mmwr_year, mmwr_week, 
      health_officer_region
  ) 

by_HOR_pop <-
  calc_total_rates_pop(
      df = df, pop_col = total_HOR_pop, 
      health_officer_region
  )

```


```{r, echo = FALSE}

by_HOR_pop %>%
  select(
    health_officer_region,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```


```{r, eval = FALSE}

by_HOR_week <- 
  counts_week_groups(
      df = df, mmwr_year, mmwr_week, 
      health_officer_region
  ) 

by_HOR_pop <-
  calc_total_rates_pop(
      df = df, pop_col = total_HOR_pop, 
      health_officer_region
  )

```

\newpage


### Top 10 Highest Severe Infection Rates by County

```{r, echo = FALSE}

by_cnty_week <- 
  counts_week_groups(
      df = df, mmwr_year, mmwr_week, 
      county, health_officer_region
  ) 

by_cnty_pop <-
  calc_total_rates_pop(
      df = df, pop_col = total_cnty_pop, 
      health_officer_region, county
  ) %>% arrange(health_officer_region, county)

```


```{r, echo = FALSE}

by_cnty_pop %>%
  select(
    county,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```


```{r, eval = FALSE}

by_cnty_week <- 
  counts_week_groups(
      df = df, mmwr_year, mmwr_week, 
      county, health_officer_region
  ) 

by_cnty_pop <-
  calc_total_rates_pop(
      df = df, pop_col = total_cnty_pop, 
      health_officer_region, county
  ) %>% arrange(health_officer_region, county)

```

\newpage

### By Sex

* initial note: males have higher infection rate; but females have higher rates of severe infections and unrecovered

```{r, echo = FALSE}

by_sex_cnty <-
  calc_total_rates_pop(
      df = df, pop_col = total_sex_pop, 
      health_officer_region, county, sex
  ) %>% arrange(health_officer_region, county, sex)

by_sex_total <-
  calc_total_rates_pop(
      df = df, pop_col = total_sex_pop, sex
  ) 

```


```{r, echo = FALSE}

by_sex_total %>%
  select(
    sex,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```


```{r, eval = FALSE}

by_sex_cnty <-
  calc_total_rates_pop(
      df = df, pop_col = total_sex_pop, 
      health_officer_region, county, sex
  ) %>% arrange(health_officer_region, county, sex)

by_sex_total <-
  calc_total_rates_pop(
      df = df, pop_col = total_sex_pop, sex
  ) 

```



\newpage

### By Race and Ethnicity 

* initial note: Hispanic population has highest infection rate, severe infection rate, and unrecovered rate -- all across the board -- this community is being impacted the most.

```{r, echo = FALSE}

by_race_cnty <-
  calc_total_rates_pop(
      df = df, pop_col = total_race_pop, 
      health_officer_region, county, race_long) %>%
  arrange(health_officer_region, county, race_long)


by_race_total <-
  calc_total_rates_pop(df = df, pop_col = total_race_pop, race_long) 

```


```{r, echo = FALSE}

by_race_total %>%
  select(
    race_long,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```



```{r, eval = FALSE}

by_race_cnty <-
  calc_total_rates_pop(
      df = df, pop_col = total_race_pop, 
      health_officer_region, county, race_long) %>%
  arrange(health_officer_region, county, race_long)


by_race_total <-
  calc_total_rates_pop(df = df, pop_col = total_race_pop, race_long) 

```