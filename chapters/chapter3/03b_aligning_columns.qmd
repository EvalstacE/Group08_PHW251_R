# Aligning Column Names

```{r}
#| include: false
#| warning: false
#| message: false

source("_common.R")

```



We brought in the raw datasets provided and first ensured that all column names referring to the same variables were consistent across the three databases, using the provided codebook as a reference. Standardizing these names improved both the efficiency of subsequent analyses and the clarity of the data dictionary developed later in this report.

To facilitate merging, we added a county field to the Los Angeles County database so that both datasets share the same set of columns, allowing them to be joined or appended to create a single statewide morbidity dataset for later analyses.



```{r, eval = FALSE}

##-- California dataset:
step1_ca_df <- raw_ca_df %>% select(-dt_diagnosis) %>%
  mutate(
    county = clean(county) %>% 
      str_remove("\\s*[Cc]ounty$") %>% 
      str_trim()
  )

##-- LA county dataset:
step1_la_cnty_df <- raw_la_cnty_df %>%
  rename(
      "age_cat"                = "age_category", 
      "race_ethnicity"         = "race_eth",
      "new_infections"         = "dx_new",
      "cumulative_infected"    = "infected_cumulative",
      "new_unrecovered"        = "unrecovered_new",
      "cumulative_unrecovered" = "unrecovered_cumulative",
      "new_severe"             = "severe_new",
      "cumulative_severe"      = "severe_cumulative"
  ) %>%
  mutate(county = "Los Angeles") %>%
  relocate(county, .before = everything()) 

##-- Population dataset:
step1_pop_df <- raw_pop_df %>% 
  rename("race_ethnicity" = "race7") %>%
  mutate(
    county = clean(county),
##-- fix "WhiteTE NH" typo:    
    race_ethnicity = str_replace(race_ethnicity, "WhiteTE NH", "White NH")
  )


#-write.csv(step1_ca_df, file = here("data/tbl_outputs_03/step1_ca_df.csv"), row.names = FALSE)
#-write.csv(step1_la_cnty_df, file = here("data/tbl_outputs_03/step1_la_cnty_df.csv"), row.names = FALSE)
#-write.csv(step1_pop_df, file = here("data/tbl_outputs_03/step1_pop_df.csv"), row.names = FALSE)
```


|
|

After completing these adjustments --- renaming columns in the Los Angeles County database and adding the county field --- the remaining tasks involve reconciling the age category and race/ethnicity variable, and standardizing how the timing of infection is identified using MMWR weeks (see **Figure 1** below).

|

#### Figure 1. Aligning Column Names

![](../../www/cleaned_col_tbl.png){.lightbox width="75%"}



