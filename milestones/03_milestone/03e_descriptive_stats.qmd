
# Descriptive Statistics: Morbidity Datasets


```{r}
#| include: false
#| warning: false
#| message: false

# Load and install packages
pacman::p_load(
  dplyr, tidyr, ggplot2, lubridate, ggthemes, cowplot, readr, rlang, purrr, rlang,
  classInt, tidycensus, sf, here, stringr, purrr, svglite, rmapshaper, readxl,
  scales, ggrepel, viridis, RColorBrewer, maps, ggfx, glue, skimr, DataExplorer,
  knitr, kableExtra, janitor, reactable, MMWRweek
)

# Source all helper functions
func_dir <- here::here("functions")
r_files <- list.files(func_dir, pattern = "\\.R$", full.names = TRUE)
purrr::walk(r_files, source)

```


```{r}

# Bring in final combined database
##-- CA + LA + Population
df <- read.csv(file = here("data/cleaned_data/combined_df.csv"))

##-- final individual, cleaned databases:
ca_df <- read.csv(file = here("data/cleaned_data/cleaned_ca_df.csv"))
la_cnty_df <- read.csv(file = here("data/cleaned_data/cleaned_la_cnty_df.csv"))
pop_df <- read.csv(file = here("data/cleaned_data/cleaned_pop_df.csv"))

```


to do: 

* Overall descriptive stats: 

  * infections by age group / county / region / race/ethnicity 
  * severe infections by age group / county / region / race/ethnicity
  * unrecovered infections by age group / county / region / race/ethnicity
  
  * infections/severe infections/unrecovered infections by MMWR week
  * infections/severe infections/unrecovered infections by MMWR week / county or region

* Create a rate metric and summarize to include only one row per strata of interest
* Aggregate the data into a new dataframe(s) to include only one row per strata of interest

  * crude rates (# / 100,000 population) per demographic: county, health officer region, sex, race / ethnicity



* maybe do age-adjusted / other adjusted rates later...
  * age-adjusted rates - compare AAR across county / region
  * Incidence rate / densities by age group and month?
  * Incidence rate / densities by race/ethnicity and month?
    


\newpage

## Calculating Crude Rates

see functions found in: "_functions/calc_total_rates_pop.R"

+ add explanation / documentation of functions here and what they do



```{r}

by_HOR_pop <-
  calc_total_rates_pop(df, pop_col = total_HOR_pop, health_officer_region)


by_cnty_pop <-
  calc_total_rates_pop(df, pop_col = total_cnty_pop, health_officer_region, county) 


by_age_total <- 
  calc_total_rates_pop(df, pop_col = pop, age_cat) 


by_sex_total <-
  calc_total_rates_pop(df, pop_col = total_sex_pop, sex) 


by_race_total <-
  calc_total_rates_pop(df, pop_col = total_race_pop, race_long)


```



\newpage

### Infection Rates by Health Officer Region


```{r, echo = FALSE}

by_HOR_pop %>%
  select(
    health_officer_region,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```


\newpage


### Top 10 Highest Severe Infection Rates by County


```{r, echo = FALSE}

by_cnty_pop %>%
  select(
    county,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```


\newpage


### Age Group


```{r, echo = FALSE}

by_age_total %>%
  select(
    age_cat,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(age_cat) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```



\newpage


### By Sex

* initial note: males have higher infection rate; but females have higher rates of severe infections and unrecovered



```{r, echo = FALSE}

by_sex_total %>%
  select(
    sex,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```




\newpage

### By Race and Ethnicity 

* initial note: Hispanic population has highest infection rate, severe infection rate, and unrecovered rate -- all across the board -- this community is being impacted the most.


```{r, echo = FALSE}

by_race_total %>%
  select(
    race_long,
    total_pop,
    matches("_rate($|_)")
  ) %>% arrange(desc(sev_rate_100k)) %>%
  slice_head(n=10) %>%
  
  kbl(escape = FALSE, align = "c") %>%
  row_spec(0, 
       bold = TRUE, 
       background = "#0f172a",
       extra_css = "font-size: 16px!important;color:#ffffff;") %>%
  
  column_spec(4, 
       bold = TRUE, 
       background = "#5ce1e6"
       ) %>%  
  
  kable_styling(bootstrap_options = c("bordered"))

```

